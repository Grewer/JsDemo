<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>loki</title>
</head>
<body>
<script src="https://cdn.bootcdn.net/ajax/libs/lokijs/1.5.9/lokijs.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/lokijs/1.5.9/loki-indexed-adapter.min.js"></script>
<script type="module">
    console.log('run')

    var adapter = new LokiIndexedAdapter();
    var db = new loki('Example');

    db.loadDatabase({}, error => {
        error && console.log(error)
    })
    const coll = db.getCollection('users')

    console.log('判断是否存在 collection', coll)

    if (!coll) {
        console.log('无 coll, 需要创建 users')
        // create col
        var users = db.addCollection('users', {indices: ['email']});
        // add data
        var odin = users.insert({name: 'odin', email: 'odin.soap@lokijs.org', age: 38});
        var thor = users.insert({name: 'thor', email: 'thor.soap@lokijs.org', age: 25});
        var stan = users.insert({name: 'stan', email: 'stan.soap@lokijs.org', age: 29});
        var oliver = users.insert({name: 'oliver', email: 'oliver.soap@lokijs.org', age: 31});
        var hector = users.insert({name: 'hector', email: 'hector.soap@lokijs.org', age: 15});
        var achilles = users.insert({name: 'achilles', email: 'achilles.soap@lokijs.org', age: 31});

        db.saveDatabase(error => {
            console.log('保存数据')
            error && console.log(error)
        })
    }

    const dv = coll.addDynamicView('test');

    dv.applyFind({ 'name' : 'odin' });

    const results = dv.data();

    console.log(results)

    const dv2 = coll.addDynamicView('test2');

    dv2.applyWhere(function(obj) { return obj.name === 'oliver'; });

    const results2 = dv2.data();

    console.log(results2)

    const dv3 = coll.addDynamicView('test3');

    dv3.applySimpleSort("age");

    const results3 = dv3.data();

    console.log(results3)

    const resultsLine1 = coll.chain().data();

    console.log(resultsLine1)


    console.log(coll.chain())


    const resultsLine2 = coll.chain().find({ 'name' : 'odin' }).data();

    console.log('resultsLine2',resultsLine2)


    const resultsLine3 = coll.chain().simplesort('age').data();

    console.log('resultsLine3',resultsLine3)

    // 修改:
    const item = resultsLine2[0]
    item.age = 18

    coll.update(item);

    console.log(coll.chain().data())
</script>
</body>
</html>
