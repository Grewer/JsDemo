<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<script>
    
    // 思路
    // 首先我们要固定一张图片的宽度 比如 200px
    // 这样根据屏幕宽度算出, 可以有多少列
    // 假如有 3 列, 那么我们需要 3 个数组, 每个数组的值就是这一列, 每张图片的高度
    // 通过高度的叠加, 使用绝对定位控制图片位置
    // 数据源


    const width = 200; // 默认设置为 200px 的宽度
    const columns = Math.floor(window.innerWidth/200) // 计算出当前页面的列

    const columnsHeightArr = new Array(columns).fill(0).map(_=>[]);
    
    const urls = new Array(10).fill(0).map((it, index)=>{
        return `https://grewer.github.io/JsDemo/waterfallLayout/imgs/img_${index}.png`
    })
    
    let flag = 0
    
    const getImg = (url) =>{
        let img = new Image();
        img.src = url;
        
        const imgCallback = () => {
            flag++;
            // 全部图片加载完毕后再开始布局，否则获取不到元素的最终高度。
            if (flag === urls.length) {
                main();
            } 
        }
        
        if (img.complete){
            imgCallback()
        } else {
            img.onload = imgCallback
        }
    }
    
    const imgInit = () => {
        urls.forEach(url=>{
            getImg(url)
        })
    }
    
    const main = () => {
        console.log('图片初始化完毕');
    }

    // 在这之前我们可以添加 loading
    imgInit();

</script>

</body>
</html>